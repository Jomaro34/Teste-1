<!DOCTYPE html>
<html lang="pt">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Assistente Local ‚Äî Corre√ß√µes + Mem√≥ria + Dicion√°rio</title>
<style>
  :root{--bg:#f3f6f9;--card:#fff;--accent:#0b63a7;--muted:#6b7280}
  body{font-family:Inter,Segoe UI,Arial,sans-serif;background:var(--bg);margin:0;padding:24px}
  .wrap{max-width:1100px;margin:0 auto}
  header{display:flex;align-items:center;gap:16px;margin-bottom:18px}
  h1{margin:0;font-size:20px}
  .grid{display:grid;grid-template-columns:1fr 420px;gap:18px}
  .card{background:var(--card);padding:16px;border-radius:12px;box-shadow:0 6px 18px rgba(2,6,23,0.06)}
  textarea{width:100%;min-height:140px;border:1px solid #e6eef6;border-radius:8px;padding:12px;font-size:15px}
  button{background:var(--accent);color:#fff;border:none;padding:8px 12px;border-radius:8px;cursor:pointer}
  .secondary{background:#475569}
  .muted{color:var(--muted);font-size:13px}
  .row{display:flex;gap:8px;align-items:center}
  .mem-list{max-height:300px;overflow:auto;border:1px solid #eef3f8;padding:8px;border-radius:8px}
  .mem-item{padding:8px;border-bottom:1px solid #f1f5f9}
  .small{font-size:13px}
  .controls{display:flex;gap:8px;flex-wrap:wrap}
  .pill{background:#eef6fb;padding:6px 8px;border-radius:999px;font-size:13px}
  input[type="file"]{display:none}
  .rule-count{font-weight:600}
  .search-result{padding:8px;border-radius:6px;margin-bottom:6px;background:#fcfeff;border:1px solid #eef7ff}
  mark{background:yellow}
  .meta{font-size:12px;color:var(--muted)}
  .footer{margin-top:12px;font-size:13px;color:var(--muted)}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <h1>üõ†Ô∏è Assistente Local ‚Äî Corre√ß√µes + Mem√≥ria + Dicion√°rio</h1>
    <div class="muted">(carrega <code>memoria.json</code> e <code>dicionario_raw.json</code> automaticamente se dispon√≠veis)</div>
  </header>

  <div class="grid">
    <div class="card">
      <h3>‚úçÔ∏è Editor</h3>
      <textarea id="inputText" placeholder="Escreve aqui..." spellcheck="true"></textarea>
      <div style="height:12px"></div>
      <div class="controls">
        <button id="btnCorrigir">Corrigir (aplicar regras)</button>
        <button id="btnExplicar" class="secondary">Explicar erros</button>
        <button id="btnAdicionar">Adicionar √† mem√≥ria</button>
        <button id="btnConsultarDic" class="secondary">Consultar Dicion√°rio</button>
        <button id="btnLimpar" class="secondary">Limpar</button>
        <div class="pill">Regras: <span id="ruleCount" class="rule-count"></span></div>
      </div>

      <div style="height:12px"></div>
      <h4>üì• Importar / Exportar</h4>
      <div class="row" style="gap:6px;margin-bottom:8px">
        <label class="secondary" for="fileRules" style="padding:8px;border-radius:8px;cursor:pointer">Importar regras (rules.json)</label>
        <input id="fileRules" type="file" accept="application/json">
        <label class="secondary" for="fileMem" style="padding:8px;border-radius:8px;cursor:pointer">Importar mem√≥ria (.json)</label>
        <input id="fileMem" type="file" accept="application/json">
        <button id="exportMem" class="">Exportar mem√≥ria</button>
      </div>

      <div style="height:12px"></div>
      <h4>üì§ Resultado</h4>
      <textarea id="outputText" readonly></textarea>

      <div class="footer">Abra via servidor HTTP (<code>python -m http.server</code>) e coloque <code>memoria.json</code> e <code>dicionario_raw.json</code> na mesma pasta.</div>
    </div>

    <div class="card">
      <h3>üíæ Mem√≥ria Inteligente</h3>

      <div style="display:flex;gap:8px;margin-bottom:8px;align-items:center">
        <input id="searchQ" placeholder="Pesquisar na mem√≥ria (fuzzy)" style="flex:1;padding:8px;border-radius:8px;border:1px solid #eef3f8">
        <button id="btnSearch" class="secondary">Pesquisar</button>
      </div>

      <div style="display:flex;gap:6px;margin-bottom:10px;align-items:center">
        <button id="btnAutoLoad" class="">Carregar memoria.json</button>
        <button id="btnClearMem" class="secondary">Limpar mem√≥ria</button>
      </div>

      <div class="muted small">Resultados:</div>
      <div class="mem-list" id="memoriaLista"></div>

      <div style="height:10px"></div>
      <h4>üîß Regras (gerir)</h4>
      <div class="muted small">Pode importar um <code>rules.json</code> para substituir ou estender as regras. Suporta regex e substitui√ß√µes.</div>
      <div style="height:8px"></div>
      <button id="btnShowRules" class="secondary">Ver / Editar regras em JSON</button>
    </div>
  </div>
</div>

<!-- Modal de regras -->
<div id="rulesModal" style="display:none;position:fixed;inset:0;background:rgba(2,6,23,0.5);align-items:center;justify-content:center">
  <div style="width:90%;max-width:900px;background:#fff;border-radius:12px;padding:14px;">
    <h3>Regras (JSON)</h3>
    <textarea id="rulesEditor" style="min-height:260px;width:100%;border:1px solid #eef3f8;border-radius:8px;padding:10px"></textarea>
    <div style="margin-top:8px;display:flex;gap:8px;justify-content:flex-end">
      <button id="saveRules">Salvar regras</button>
      <button id="closeRules" class="secondary">Fechar</button>
    </div>
  </div>
</div>

<script>
// ================= Dicion√°rio =================
let dicionario = {};
fetch('./dicionario_raw.json')
  .then(r => r.json())
  .then(json => { dicionario = json; console.log('Dicion√°rio carregado', Object.keys(dicionario).length, 'palavras'); })
  .catch(err => console.error('Erro ao carregar dicion√°rio:', err));

function consultarPalavra(palavra) {
  const entry = dicionario[palavra];
  if(!entry) return 'Palavra n√£o encontrada no dicion√°rio.';
  return entry.map(s => `Defini√ß√£o: ${s.definicao}\nCategoria: ${s.categoria}\nContexto: ${s.contexto}`).join("\n\n");
}

document.getElementById('btnConsultarDic').addEventListener('click', ()=>{
  const palavra = document.getElementById('inputText').value.trim();
  if(!palavra) { alert('Escreva uma palavra para consultar'); return; }
  document.getElementById('outputText').value = consultarPalavra(palavra);
});

// ================= Regras e Mem√≥ria (simplificado) =================
let regras = [];
let memoria = [];

function carregarRegrasPadrao(){
  regras = [
    {id:'r_espacos',pattern:'\\s{2,}','flags':'g',replacement:' ',description:'Remove espa√ßos duplicados'}
  ];
  document.getElementById('ruleCount').textContent = regras.length;
}

function corrigirTexto(){
  let texto = document.getElementById('inputText').value;
  for(const r of regras){
    const re = new RegExp(r.pattern, r.flags||'g');
    texto = typeof r.replacement==='function' ? texto.replace(re,r.replacement) : texto.replace(re,r.replacement);
  }
  document.getElementById('outputText').value = texto;
}

function adicionarMemoria(){
  const text = document.getElementById('inputText').value.trim();
  if(!text) return;
  memoria.unshift({id:Date.now().toString(),text,addedAt:new Date().toISOString()});
  atualizarListaMemoria();
}

function atualizarListaMemoria(){
  const box = document.getElementById('memoriaLista');
  box.innerHTML = '';
  for(const m of memoria){
    const div = document.createElement('div');
    div.className='mem-item';
    div.innerHTML = `<div style="font-weight:600">${m.text.slice(0,120)}</div><div class="meta">id: ${m.id} ‚Ä¢ ${new Date(m.addedAt).toLocaleString()}</div>`;
    box.appendChild(div);
  }
}

// Eventos
document.getElementById('btnCorrigir').addEventListener('click', corrigirTexto);
document.getElementById('btnAdicionar').addEventListener('click', adicionarMemoria);
document.getElementById('btnLimpar').addEventListener('click', ()=>{ document.getElementById('inputText').value=''; document.getElementById('outputText').value=''; });
document.getElementById('btnExplicar').addEventListener('click', ()=>alert('Relat√≥rio de corre√ß√µes n√£o implementado neste exemplo.'));

// Inicializa√ß√£o
carregarRegrasPadrao();

</script>
</body>
</html>
