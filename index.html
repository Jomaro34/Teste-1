<!DOCTYPE html>
<html lang="pt">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Livro de Seres Imagin√°rios / Book of Imaginary Beings</title>
<link rel="icon" href="favicon.png" type="image/png">
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
<style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: 'Segoe UI', Roboto, Arial, sans-serif; background: #f9f9f9; display: flex; flex-direction: column; min-height: 100vh; }

    /* HEADER */
    .header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 25px 15px;
        text-align: center;
        box-shadow: 0 3px 8px rgba(0,0,0,0.2);
    }
    .header h1 {
        font-size: 1.9em;
        font-weight: 700;
        margin-bottom: 10px;
    }
    .header p {
        font-size: 1em;
        color: #000;
        background: rgba(255,255,255,0.9);
        display: inline-block;
        padding: 6px 10px;
        border-radius: 6px;
        margin-bottom: 10px;
    }
    .header a {
        color: #000;
        font-weight: 600;
        text-decoration: none;
        display: block;
        margin-top: 6px;
    }
    .header a:hover {
        text-decoration: underline;
    }

    /* MAIN */
    .main { display: flex; flex: 1; min-height: 75vh; flex-wrap: wrap; }
    .sidebar {
        width: 300px;
        background: #fff;
        overflow-y: auto;
        padding: 15px;
        border-right: 1px solid #ddd;
    }
    .sidebar h3 { margin-bottom: 10px; }
    .sidebar ul { list-style: none; }
    .sidebar li {
        cursor: pointer;
        padding: 5px 0;
        border-bottom: 1px solid #eee;
        transition: background 0.3s;
    }
    .sidebar li:hover { background: #f0f0f0; }

    .pdf-container {
        flex: 1;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: flex-start;
        padding: 20px;
        background: #fff;
    }

    /* DOWNLOAD BOX */
    .download-box {
        background: #3498db;
        color: white;
        padding: 10px 20px;
        border-radius: 8px;
        margin-bottom: 20px;
        box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        cursor: pointer;
        transition: background 0.3s, transform 0.2s;
        font-weight: 600;
        text-align: center;
    }
    .download-box:hover {
        background: #2980b9;
        transform: scale(1.05);
    }

    canvas {
        border: 1px solid #ccc;
        border-radius: 6px;
        max-width: 100%;
        box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }

    /* MOBILE */
    @media (max-width: 900px) {
        .main { flex-direction: column; }
        .sidebar {
            width: 100%;
            max-height: 300px;
            border-right: none;
            border-bottom: 1px solid #ddd;
        }
        .pdf-container {
            padding: 10px;
        }
        .header h1 { font-size: 1.4em; }
    }
</style>
</head>
<body>

<div class="header">
    <h1>üìö Livro de Seres Imagin√°rios / Book of Imaginary Beings</h1>
    <p>Explore o mundo dos Seres Imagin√°rios / Explore the world of Imaginary Beings</p>
    <a href="https://jomaro34.github.io/Jomaro-Cabrela/" target="_blank">@2025 Jomaro Cabrela</a>
</div>

<div class="main">
    <div class="sidebar">
        <h3>√çndice de Palavras</h3>
        <ul id="index-list"></ul>
    </div>

    <div class="pdf-container">
        <div class="download-box" onclick="downloadPDF()">‚¨áÔ∏è Download PDF</div>
        <canvas id="pdf-canvas"></canvas>
    </div>
</div>

<script>
pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

const canvas = document.getElementById('pdf-canvas');
const ctx = canvas.getContext('2d');
const indexList = document.getElementById('index-list');

let pdfDoc = null;
let pageNum = 1;
let scale = 1.5;
let pageRendering = false;
let pageNumPending = null;

let indexData = {}; // { palavra: [paginas] }
const stopWords = ["e","de","o","a","que","com","em","para","os","as","um","uma","no","na","dos","das","ao","√†","do","da","se","por","como","mais","ou","s√≥","mas","foi","ser","est√°","est√£o","nas","nos","s√£o","era","tem","h√°","bem","lhe","eles","elas","isso","isto"];

async function loadPDF(url) {
    pdfDoc = await pdfjsLib.getDocument(url).promise;
    await buildIndex();
    renderPage(pageNum);
}

async function buildIndex() {
    for (let i = 1; i <= pdfDoc.numPages; i++) {
        const page = await pdfDoc.getPage(i);
        const content = await page.getTextContent();
        const pageText = content.items.map(item => item.str).join(' ');
        const words = pageText.split(/\W+/).filter(w => w.length > 2 && !stopWords.includes(w.toLowerCase()));

        words.forEach(word => {
            const w = word.toLowerCase();
            if (!indexData[w]) indexData[w] = [];
            if (!indexData[w].includes(i)) indexData[w].push(i);
        });
    }
    displayIndex();
}

function displayIndex() {
    const sortedWords = Object.keys(indexData).sort();
    sortedWords.forEach(word => {
        const li = document.createElement('li');
        li.textContent = `${word} ‚Üí ${indexData[word].join(', ')}`;
        li.addEventListener('click', () => goToPage(indexData[word][0]));
        indexList.appendChild(li);
    });
}

async function renderPage(num) {
    pageRendering = true;
    const page = await pdfDoc.getPage(num);
    const viewport = page.getViewport({scale: scale});
    canvas.height = viewport.height;
    canvas.width = viewport.width;
    await page.render({canvasContext: ctx, viewport: viewport}).promise;
    pageRendering = false;
}

function goToPage(num) {
    pageNum = num;
    if (pageRendering) pageNumPending = num;
    else renderPage(num);
}

function downloadPDF() {
    const link = document.createElement('a');
    link.href = 'Seres_Imaginarios.pdf';
    link.download = 'Seres_Imaginarios.pdf';
    link.click();
}

loadPDF('Seres_Imaginarios.pdf');
</script>

</body>
</html>
