<!DOCTYPE html>
<html lang="pt">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Livro de Seres Imagin√°rios / Book of Imaginary Beings</title>
<link rel="icon" href="favicon.png" type="image/png">
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>

<style>
  :root{
    --accent:#3498db;
    --bg-grad-start:#667eea;
    --bg-grad-end:#764ba2;
    --panel-bg:#ffffff;
    --text:#2c3e50;
    --highlight:#fff59d;
  }
  *{box-sizing:border-box;margin:0;padding:0;text-decoration:none}
  body{
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
    background: linear-gradient(135deg, var(--bg-grad-start) 0%, var(--bg-grad-end) 100%);
    color:var(--text);
    min-height:100vh;
    display:flex;flex-direction:column;
  }

  .header{
    background:rgba(255,255,255,0.95);
    padding:24px 16px;text-align:center;
    box-shadow:0 4px 8px rgba(0,0,0,0.08);
  }
  .header h1{font-size:1.9rem;font-weight:700;margin-bottom:8px}
  .header p.subtitle{display:inline-block;background:#fff;padding:6px 10px;border-radius:6px}
  .header a.credit{display:block;margin-top:8px;color:#000;font-weight:700}

  .toolbar{
    background:rgba(44,62,80,0.95);color:#fff;padding:12px 14px;
    display:flex;gap:12px;align-items:center;flex-wrap:wrap;
    position:sticky;top:0;z-index:40;
  }
  .search-box{display:flex;gap:8px;align-items:center;flex:1;min-width:220px}
  .search-box input{flex:1;padding:10px 12px;border-radius:8px;border:none;font-size:14px}
  .search-box button{background:var(--accent);border:none;padding:10px 12px;border-radius:8px;color:#fff;cursor:pointer}
  .controls{display:flex;gap:8px;align-items:center}
  .controls button,.controls a{background:var(--accent);color:#fff;border:none;padding:8px 10px;border-radius:8px;cursor:pointer}
  .page-info{color:#fff;background:rgba(255,255,255,0.08);padding:6px 10px;border-radius:8px;font-weight:600}

  .content{display:flex;gap:18px;max-width:1400px;margin:20px auto;padding:0 16px;width:100%;align-items:flex-start}

  .sidebar{
    width:340px;background:var(--panel-bg);border-radius:12px;box-shadow:0 10px 30px rgba(0,0,0,0.2);
    max-height:calc(100vh - 180px);overflow:auto;padding:12px;display:none;
  }
  .sidebar.active{display:block}
  .sidebar h4{margin-bottom:8px}
  .result-item{padding:12px;border-bottom:1px solid #f0f0f0;cursor:pointer}
  .result-item:hover{background:#fafafa}
  .result-page{font-size:12px;color:#7f8c8d;font-weight:700;margin-bottom:6px}
  .result-excerpt{font-size:14px;color:var(--text);line-height:1.4}
  .result-excerpt mark{background:var(--highlight);padding:2px 3px;border-radius:3px;font-weight:700}

  .pdf-panel{
    flex:1;background:var(--panel-bg);border-radius:12px;padding:20px;box-shadow:0 10px 30px rgba(0,0,0,0.2);
    position:relative;min-height:60vh;display:flex;justify-content:center;align-items:flex-start;
  }
  #pdf-canvas{max-width:100%;border-radius:6px;display:block}
  .loading{padding:40px;text-align:center;color:#7f8c8d}
  .spinner{border:4px solid #ecf0f1;border-top:4px solid var(--accent);border-radius:50%;width:48px;height:48px;animation:spin 1s linear infinite;margin:18px auto}
  @keyframes spin{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}

  @media (max-width:1000px){
    .sidebar{width:100%;max-height:260px}
    .content{flex-direction:column;gap:12px;padding-bottom:40px}
    .pdf-panel{min-height:50vh;padding:12px}
  }
</style>
</head>
<body>
<header class="header">
  <h1>üìö Livro de Seres Imagin√°rios / Book of Imaginary Beings</h1>
  <p class="subtitle">Explore o mundo dos Seres Imagin√°rios / Explore the world of Imaginary Beings</p>
  <a class="credit" href="https://jomaro34.github.io/Jomaro-Cabrela/" target="_blank">@2025 Jomaro Cabrela</a>
</header>

<div class="toolbar">
  <div class="search-box">
    <input id="search-input" type="search" placeholder="üîç Pesquisar no documento..." />
    <button id="search-btn">Procurar</button>
    <button id="clear-btn">Limpar</button>
  </div>

  <div class="controls">
    <button id="zoom-out">‚àí</button>
    <button id="zoom-in">+</button>
    <button id="prev-page">‚Üê</button>
    <div class="page-info" id="page-info">P√°gina: -/-</div>
    <button id="next-page">‚Üí</button>
    <a href="Seres_Imaginarios.pdf" download>‚¨áÔ∏è Download PDF</a>
  </div>
</div>

<main class="content">
  <aside class="sidebar" id="sidebar">
    <h4>üìã Resultados da Pesquisa</h4>
    <div id="results"></div>
  </aside>

  <section class="pdf-panel">
    <div class="loading" id="loading">
      <h2>üìÑ A carregar PDF...</h2>
      <div class="spinner"></div>
      <p>Seres_Imaginarios.pdf</p>
    </div>
    <canvas id="pdf-canvas" style="display:none"></canvas>
  </section>
</main>

<script>
pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

const URL_PDF = 'Seres_Imaginarios.pdf';
const canvas = document.getElementById('pdf-canvas');
const ctx = canvas.getContext('2d');
const loadingEl = document.getElementById('loading');
const sidebar = document.getElementById('sidebar');
const resultsEl = document.getElementById('results');
const pageInfo = document.getElementById('page-info');

let pdfDoc=null,pageNum=1,scale=1.5,pageRendering=false,pageNumPending=null,currentSearchTerm='',matchesByPage={},pageTextStore={};

async function loadPDF(url){
  try{
    const pdf = await pdfjsLib.getDocument(url).promise;
    pdfDoc = pdf;
    pageInfo.textContent = `P√°gina: ${pageNum}/${pdf.numPages}`;
    loadingEl.style.display='none';canvas.style.display='block';
    renderPage(pageNum);
  }catch(e){loadingEl.innerHTML='<h2>‚ùå Erro ao carregar PDF</h2>';console.error(e);}
}

async function renderPage(num){
  pageRendering=true;
  const page = await pdfDoc.getPage(num);
  const viewport = page.getViewport({scale});
  canvas.height=viewport.height;canvas.width=viewport.width;
  await page.render({canvasContext:ctx,viewport}).promise;
  pageRendering=false;
  pageInfo.textContent=`P√°gina: ${num}/${pdfDoc.numPages}`;
  if(pageNumPending!==null){renderPage(pageNumPending);pageNumPending=null;}
}
function queueRenderPage(num){if(pageRendering)pageNumPending=num;else renderPage(num);}
document.getElementById('prev-page').onclick=()=>{if(pageNum<=1)return;pageNum--;queueRenderPage(pageNum);}
document.getElementById('next-page').onclick=()=>{if(pageNum>=pdfDoc.numPages)return;pageNum++;queueRenderPage(pageNum);}
document.getElementById('zoom-in').onclick=()=>{scale+=0.25;renderPage(pageNum);}
document.getElementById('zoom-out').onclick=()=>{if(scale>0.5){scale-=0.25;renderPage(pageNum);}}

document.getElementById('search-btn').onclick=searchPDF;
document.getElementById('clear-btn').onclick=clearSearch;
document.getElementById('search-input').addEventListener('keypress',e=>{if(e.key==='Enter')searchPDF();});

async function searchPDF(){
  const q=document.getElementById('search-input').value.trim().toLowerCase();
  if(!q||!pdfDoc)return;
  currentSearchTerm=q;matchesByPage={};resultsEl.innerHTML='';sidebar.classList.remove('active');
  for(let i=1;i<=pdfDoc.numPages;i++){
    const page=await pdfDoc.getPage(i);
    const text=await page.getTextContent();
    const joined=text.items.map(it=>it.str).join(' ');
    if(joined.toLowerCase().includes(q))matchesByPage[i]=joined;
  }
  const pages=Object.keys(matchesByPage);
  if(!pages.length){resultsEl.innerHTML='<div style="padding:12px;color:#a00">‚úó Nenhum resultado</div>';return;}
  sidebar.classList.add('active');
  resultsEl.innerHTML='';
  pages.forEach(p=>{
    const t=matchesByPage[p];
    const idx=t.toLowerCase().indexOf(q);
    const start=Math.max(0,idx-80),end=Math.min(t.length,idx+q.length+80);
    const snippet=(start>0?'...':'')+t.substring(start,end)+(end<t.length?'...':'');
    const safe=snippet.replace(/[&<>]/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;'}[c]));
    const html=safe.replace(new RegExp(q,'gi'),m=>`<mark>${m}</mark>`);
    const div=document.createElement('div');
    div.className='result-item';
    div.innerHTML=`<div class="result-page">üìÑ P√°gina ${p}</div><div class="result-excerpt">${html}</div>`;
    div.onclick=()=>{pageNum=parseInt(p);queueRenderPage(pageNum);if(window.innerWidth<900)window.scrollTo({top:canvas.offsetTop,behavior:'smooth'});}
    resultsEl.appendChild(div);
  });
}
function clearSearch(){
  document.getElementById('search-input').value='';currentSearchTerm='';matchesByPage={};
  sidebar.classList.remove('active');resultsEl.innerHTML='';renderPage(pageNum);
}
loadPDF(URL_PDF);
</script>
</body>
</html>
